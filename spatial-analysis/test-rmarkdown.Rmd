---
title: "Untitled"
author: "Daniel Emaasit"
date: "January 17, 2016"
output: html_document
---

## Data Visualisation

R has several packages for visualizing spatial data. We shall look at tradition plotting systems in R that come with an R installation, commonly named "base-R" packages. An example is the `plot()` function for spatial data in the **sp** package. We shall also explore "external" packages for doing including ggplot2, ggmap, leaflet, tmap and plotly. The purpose of this report is conduct spatial analysis of the CDR sample data.

### Visualizing the Data Using Traditional Plot System

The **sp* package provides functions for plotting spatial data by adding layers incrementally. Let's start by plotting the shapefiles of Houston Texas.
```{r plot_polygon}
plot(texas_shp, col = "grey", axes = TRUE)
```

Then let's add crime data onto the map. Use the argument `add = TRUE` to add another layer onto the plot.
```{r add_points}
plot(crime_spatial_df, pch = 21, bg = "red", cex = .5, add = TRUE)
```

Then add a title and a legend.
```{r}
title("Locations of Offensive Crimes in Houston, Texas")
legend("topleft", title = "Legend", legend = "Crime Locations", pch = 21, pt.bg = "red", bty = "n")
```

While the base functions for plotting spatial data can do the job, I prefer using external R libraries that provide more capabilities and produce beautiful maps like ggplot2, ggmap, leaflet.

### Visializing the Data Using External Libraries

#### ggplot2
ggplot2 works with data frames and not objects of class **Spatial***. So we have to convert them using the `fortify()` function in ggplot2.
```{r}
crime_df <- fortify(crime_spatial_df)
texas_shp_df <- fortify(texas_shp)
```

Now we can leverage **gplot2's** powerful plotting capabilities.
```{r ggplot_option}
p <- ggplot() + 
  geom_polygon(data = texas_shp_df, aes(x=long, y=lat, group = group)) + coord_equal() +
  geom_point(data = crime_df, aes(x = lon, y = lat, color = "red")) +
  labs(title = "Locations of Offensive Crimes in Houston, Texas") +
  xlab("Longitude") + 
  ylab("Latitude")

p
```

#### ggmap

Create the static background layer for the city of Houston, Texas
```{r BackgroundLayer, echo = TRUE, cache = TRUE}
## Use "get_map" command to download the images and format them for plotting
map_dat <- get_map(location = "houston", source = "osm", zoom = 14)
```

Use "ggmap" command to make the plot
```{r}
houstonMap <- ggmap(map_dat, extent = "device", legend = "topleft")
houstonMap
```

Geocode the entire data using longitute and latitute variables
```{r}
houstonMap2 <- houstonMap + 
  geom_point(aes(x = lon, y = lat), data = downtown_crime, alpha = 0.5, color="darkred", size = 3)

houstonMap2
```

Plot the shapefiles
```{r add_shapefiles}
houstonMap3 <- houstonMap2 + 
  geom_polygon(aes(x = long, y = lat, group = group), data = texas_shp_df, colour = "black", 
               alpha = .4, size = .3)

houstonMap3
```
